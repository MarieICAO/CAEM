# -*- coding: utf-8 -*-
"""
Created on Tue Jun 18 15:05:22 2019

@author: Maël Akouz
"""

import numpy as np
import xlwt

def Aff(txt,nb) :
    "Interpret the nb first lines of the document."
    r=0
    for line in txt :
        print(line)
        r=r+1
        if r>=nb :
            return

def Afflines(txt,nb) :
    "Print the nb first lines of the document."
    lines = txt.readlines()
    r=0
    for l in lines :
        print([l])
        r=r+1
        if r>=nb :
            return

def Line(l,a,b):
    "Extrat the valuable data of the given line."
    p=0
    while l[p]!=':' :
        p=p+1
    d=p+a
    while l[p]!=',' :
        p=p+1
    f=p-b
    return l[d:f]

def Database(txt) :
    "Build an array with an air link in each line."
    data = txt.readlines()
    tab = [['Id','Year','Airline Code','Airline Name','Airline Country','From Airport Code','From Airport Code 4','From Airport Name','From Airport Country','To Airport Code','To Airport Code 4','To Airport Name','To Airport Country','Number of Flights by Year','Number of Seat by Flight','Number of Used Planes']]
    k,i=1,1
    while i<len(data) :
        tab.append([])
        tab[k].append(Line(data[i],2,0))
        tab[k].append(int(Line(data[i+1],2,0)))
        for j in range(2,13) :
            tab[k].append(Line(data[i+j],3,1))
        tab[k].append(int(Line(data[i+13],2,0)))
        tab[k].append(int(Line(data[i+14],2,0)))
        tab[k].append(int(data[i+15][-2]))
        k=k+1
        i=i+18
    return np.array(tab)

def Excel(tab,spr,shname) :
    "Produce an Excel spreadsheet with the given array."
    sheet = spr.add_sheet(shname)
    a,b=len(tab),len(tab[0])
    for i in range(a) :
        for j in range(b) :
            sheet.write(i,j,tab[i][j])

OAG2018 = open('C:/Users/Maël Akouz/Desktop/OACI/1-1-1 States/OAG2018.txt','r')
tab = Database(OAG2018)
print('Size of the Database :')
print((len(tab),len(tab[0])))

def CodeISO(txt) :
    "Build an array with a country at each line."
    data = txt.readlines()
    tab = [['Country','Alpha-2 Code','Alpha-3 Code','Numeric code','Latitude (average)','Longitude (average)']]
    for i in range(1,len(data)) :
        l = data[i].split(',')
        tab.append([l[0].split('"')[1]])
        for j in range(1,6) :
            tab[i].append(l[j][1:].split('"')[1])
    return np.array(tab)  

Codes = open('C:/Users/Maël Akouz/Desktop/OACI/1-1-1 States/Country_Codes.txt','r')
code = CodeISO(Codes)

def Airlines(tab,code) :
    "Provide the airlines present in the selected document with their number of air links."
    Aline = [['Airline Code','Airline Name','Airline Country Name','Airline Country Code','Number of Air Links']]
    for line in tab[1:] :
        abs=True
        for al in Aline :
            if al[0]==line[2] :
                al[4]=al[4]+1
                abs=False
        if abs :
            p=0
            while p<len(code) and code[p][2]!=line[4] :
                 p=p+1
            if p==len(code) :
                Aline.append([line[2],line[3],None,line[4],1])
            else :
                Aline.append([line[2],line[3],code[p][0],line[4],1])
    return np.array(Aline)
def NationAL(tab,code) :
    "Provide the number of airline by country."
    AL = Airlines(tab,code)
    Country = [['Country Name','Country Code','Number of Airline']]
    for line in AL[1:] :
        abs=True
        for state in Country :
            if state[1]==line[3] :
                state[2]=state[2]+1
                abs=False
        if abs :
            Country.append([line[2],line[3],1])
    return np.array(Country)

def StatCountries(Country) :
    "Provide the percentage of countries which have the same number of airlines."
    tab = [['Number of Airline','Number of Country','Percent of Country']]
    for line in Country[1:] :
        abs=True
        for num in tab :
            if num[0]==line[2]:
                num[1]=num[1]+1
                abs=False
        if abs :
            tab.append([line[2],1,0])
    for line in tab[1:] :
        line[2]=line[1]/(len(Country)-1)
    return np.array(tab)

Airline = Airlines(tab,code)
print('Number of Referenced Airlines : ' + str(len(Airline)-1))
Country = NationAL(tab,code)
print('Number of Referenced Countries : ' + str(len(Country)-1))
Stat = StatCountries(Country)
spr = xlwt.Workbook()
Excel(Airline,spr,'Company')
Excel(Country,spr,'Country')
Excel(Stat,spr,'Companies by Country')
spr.save('Airline.xls')